
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>第4章 使用元组 &mdash; Erlang并发编程</title>
    <link rel="stylesheet" href="_static/nature-ext.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Erlang并发编程" href="index.html" />
    <link rel="up" title="第 I 部分 编程" href="part-i_index.html" />
    <link rel="next" title="第5章 并行编程" href="part-i_chapter-5.html" />
    <link rel="prev" title="第3章 列表编程" href="part-i_chapter-3.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="part-i_chapter-5.html" title="第5章 并行编程"
             accesskey="N">下一页</a></li>
        <li class="right" >
          <a href="part-i_chapter-3.html" title="第3章 列表编程"
             accesskey="P">上一页</a> |</li>
        <li><a href="index.html">Erlang并发编程</a> &raquo;</li>
          <li><a href="part-i_index.html" accesskey="U">第 I 部分 编程</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>第4章 使用元组<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">翻译:</th><td class="field-body">王飞</td>
</tr>
<tr class="field"><th class="field-name">校订:</th><td class="field-body">连城</td>
</tr>
</tbody>
</table>
<p>元组用以将多个对象组合成一个新的复杂对象。对象<tt class="docutils literal"><span class="pre">{E1,E2,E3,...En}</span></tt>表示一个<strong>大小为 n 的元组</strong>。元组用于描述包含<strong>固定</strong>数目的元素的数据结构；对于<strong>可变</strong>数目的元素，应该使用<strong>列表</strong>来存储。</p>
<div class="section" id="bif">
<h2>处理元组的BIF<a class="headerlink" href="#bif" title="永久链接至标题">¶</a></h2>
<p>以下是一些可以用来操纵元组的BIF：</p>
<p><tt class="docutils literal"><span class="pre">tuple_to_list(T)</span></tt></p>
<blockquote>
<div><p>将元组<tt class="docutils literal"><span class="pre">T</span></tt>转化成一个列表。</p>
<p>如：<tt class="docutils literal"><span class="pre">tuple_to_list({1,2,3,4})</span></tt>⇒<tt class="docutils literal"><span class="pre">[1,2,3,4]</span></tt>。</p>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">list_to_tuple(L)</span></tt></p>
<blockquote>
<div><p>将列表<tt class="docutils literal"><span class="pre">L</span></tt>转化成一个元组。</p>
<p>如：<tt class="docutils literal"><span class="pre">list_to_tuple([a,b,c])</span></tt>⇒<tt class="docutils literal"><span class="pre">{a,b,c}</span></tt>。</p>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">element(N,</span> <span class="pre">T)</span></tt></p>
<blockquote>
<div><p>返回元组<tt class="docutils literal"><span class="pre">T</span></tt>的第<tt class="docutils literal"><span class="pre">N</span></tt>个元素。</p>
<p>如：<tt class="docutils literal"><span class="pre">element(3,{a,b,c,d})</span></tt>⇒<tt class="docutils literal"><span class="pre">c</span></tt>。</p>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">setelement(N,</span> <span class="pre">T,</span> <span class="pre">Val)</span></tt></p>
<blockquote>
<div><p>返回一个新的元组，这个元组是将元组<tt class="docutils literal"><span class="pre">T</span></tt>的第<tt class="docutils literal"><span class="pre">N</span></tt>个元素用<tt class="docutils literal"><span class="pre">Val</span></tt>替换之后的一个拷贝。</p>
<p>如：<tt class="docutils literal"><span class="pre">setelement(3,</span> <span class="pre">{a,b,c,d},</span> <span class="pre">xx)</span></tt>⇒<tt class="docutils literal"><span class="pre">{a,b,xx,d}</span></tt>。</p>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">size(T)</span></tt></p>
<blockquote>
<div><p>返回元组<tt class="docutils literal"><span class="pre">T</span></tt>包含的元素个数。</p>
<p>如：<tt class="docutils literal"><span class="pre">size({a,b,c})</span></tt>⇒<tt class="docutils literal"><span class="pre">3</span></tt> 。</p>
</div></blockquote>
</div>
<div class="section" id="id2">
<h2>返回多个值<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>我们经常想让一个函数返回多个值，使用元组来实现这一目的是十分方便的。</p>
<p>例如，函数<tt class="docutils literal"><span class="pre">parse_int(List)</span></tt>从一个由ASCII字符构成的列表<tt class="docutils literal"><span class="pre">List</span></tt>中提取最开始的数字，如果存在，就返回一个由被提取出来的数字和列表剩下的部分组成的元组，如果列表中没有数字的话，就返回原子式<tt class="docutils literal"><span class="pre">eoString</span></tt>。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">parse_int</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">parse_int</span><span class="p">(</span><span class="n">skip_to_int</span><span class="p">(</span><span class="nv">List</span><span class="p">),</span> <span class="mi">0</span><span class="p">).</span>

<span class="nf">parse_int</span><span class="p">([</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="nv">N</span><span class="p">)</span> <span class="k">when</span> <span class="nv">H</span> <span class="o">&gt;=</span> <span class="sc">$0</span><span class="p">,</span> <span class="nv">H</span> <span class="o">=&lt;</span> <span class="sc">$9</span> <span class="o">-&gt;</span>
    <span class="n">parse_int</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="nv">N</span> <span class="o">+</span> <span class="nv">H</span> <span class="o">-</span> <span class="sc">$0</span><span class="p">);</span>
<span class="nf">parse_int</span><span class="p">([],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">eoString</span><span class="p">;</span>
<span class="nf">parse_int</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">N</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">N</span><span class="p">,</span><span class="nv">L</span><span class="p">}.</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">skip_to_int(L)</span></tt>返回<tt class="docutils literal"><span class="pre">L</span></tt>中第一个以ASCII字符<tt class="docutils literal"><span class="pre">0</span></tt>到<tt class="docutils literal"><span class="pre">9</span></tt>中的任意一个开始的子列表。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">skip_to_int</span><span class="p">([])</span> <span class="o">-&gt;</span>
    <span class="p">[];</span>
<span class="nf">skip_to_int</span><span class="p">([</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">])</span> <span class="k">when</span> <span class="nv">H</span> <span class="o">&gt;=</span> <span class="sc">$0</span><span class="p">,</span> <span class="nv">H</span> <span class="o">=&lt;</span> <span class="sc">$9</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">];</span>
<span class="nf">skip_to_int</span><span class="p">([</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">])</span> <span class="o">-&gt;</span>
    <span class="n">skip_to_int</span><span class="p">(</span><span class="nv">T</span><span class="p">).</span>
</pre></div>
</div>
<p>如果我们使用字符串<tt class="docutils literal"><span class="pre">&quot;abcd123def&quot;</span></tt>（<tt class="docutils literal"><span class="pre">&quot;abcd123def&quot;</span></tt>的列表形式是<tt class="docutils literal"><span class="pre">[97,98,99,49,50,51,100,101,102]</span></tt>）来测试<tt class="docutils literal"><span class="pre">parse_int</span></tt>：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="o">&gt;</span> <span class="nn">tuples</span><span class="p">:</span><span class="n">parse_int</span><span class="p">(</span><span class="s">&quot;abc123def&quot;</span><span class="p">).</span>
<span class="p">{</span><span class="mi">123</span><span class="p">,[</span><span class="mi">100</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">102</span><span class="p">]}}</span>
</pre></div>
</div>
<p>在<tt class="docutils literal"><span class="pre">parse_int</span></tt>的基础上，可以实现一个提取所有嵌入在字符串里面的数字的解释器。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">parse_ints</span><span class="p">([])</span> <span class="o">-&gt;</span>
    <span class="p">[];</span>
<span class="nf">parse_ints</span><span class="p">(</span><span class="nv">L</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">case</span> <span class="n">parse_int</span><span class="p">(</span><span class="nv">L</span><span class="p">)</span> <span class="k">of</span>
        <span class="n">eoString</span> <span class="o">-&gt;</span>
            <span class="p">[];</span>
        <span class="p">{</span><span class="nv">H</span><span class="p">,</span><span class="nv">Rest</span><span class="p">}</span> <span class="o">-&gt;</span>
            <span class="p">[</span><span class="nv">H</span><span class="p">|</span><span class="n">parse_ints</span><span class="p">(</span><span class="nv">Rest</span><span class="p">)]</span>
    <span class="k">end</span><span class="p">.</span>
</pre></div>
</div>
<p>因此：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="o">&gt;</span> <span class="nn">tuples</span><span class="p">:</span><span class="n">parse_ints</span><span class="p">(</span><span class="s">&quot;abc,123,def,456,xx&quot;</span><span class="p">).</span>
<span class="p">[</span><span class="mi">123</span><span class="p">,</span><span class="mi">456</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>密码加密<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>几乎每天笔者们都不得不记住许多不同的密码——信用卡的密码，门禁密码等等。这些密码可以用一种方法记录下来，并且不会被犯罪分子利用吗？</p>
<p>假设我们有一张密码为<tt class="docutils literal"><span class="pre">3451</span></tt>的LISA信用卡，它的密码可以像这样被编码：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="n">l</span> <span class="n">m</span> <span class="n">n</span> <span class="n">o</span> <span class="n">p</span> <span class="n">q</span> <span class="n">r</span> <span class="n">s</span> <span class="n">t</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span>
<span class="mi">1</span> <span class="mi">0</span> <span class="mi">5</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">9</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">6</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">5</span> <span class="mi">0</span>   <span class="n">lisa</span>
</pre></div>
</div>
<p>这样密码就可以写在一张纸上，即使这张纸落在他人手上，密码也是安全的。</p>
<p>我们如何解码信息呢？用来加密密码的密钥是公开的——因此我们可以很容易地读出密码（3451）&#8211;试试看！</p>
<p>我们很容易的就可以构造一个用来执行加密的函数<tt class="docutils literal"><span class="pre">encode(Pin,</span> <span class="pre">Password)</span></tt><a class="footnote-reference" href="#id11" id="id4">[1]</a>：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">encode</span><span class="p">(</span><span class="nv">Pin</span><span class="p">,</span> <span class="nv">Password</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">Code</span> <span class="o">=</span> <span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span>
            <span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span>
            <span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">},</span>
    <span class="n">encode</span><span class="p">(</span><span class="nv">Pin</span><span class="p">,</span> <span class="nv">Password</span><span class="p">,</span> <span class="nv">Code</span><span class="p">).</span>

<span class="nf">encode</span><span class="p">([],</span> <span class="p">_,</span> <span class="nv">Code</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">Code</span><span class="p">;</span>
<span class="nf">encode</span><span class="p">(</span><span class="nv">Pin</span><span class="p">,</span> <span class="p">[],</span> <span class="nv">Code</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Out of Letters</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,[]);</span>

<span class="nf">encode</span><span class="p">([</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="p">[</span><span class="nv">Letter</span><span class="p">|</span><span class="nv">T1</span><span class="p">],</span> <span class="nv">Code</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">Arg</span> <span class="o">=</span> <span class="n">index</span><span class="p">(</span><span class="nv">Letter</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="k">case</span> <span class="nb">element</span><span class="p">(</span><span class="nv">Arg</span><span class="p">,</span> <span class="nv">Code</span><span class="p">)</span> <span class="k">of</span>
        <span class="n">nil</span> <span class="o">-&gt;</span>
            <span class="n">encode</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">T1</span><span class="p">,</span> <span class="nb">setelement</span><span class="p">(</span><span class="nv">Arg</span><span class="p">,</span> <span class="nv">Code</span><span class="p">,</span> <span class="n">index</span><span class="p">(</span><span class="nv">H</span><span class="p">)));</span>
        <span class="p">_</span> <span class="o">-&gt;</span>
            <span class="n">encode</span><span class="p">([</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="nv">T1</span><span class="p">,</span> <span class="nv">Code</span><span class="p">)</span>
    <span class="k">end</span><span class="p">.</span>

<span class="nf">index</span><span class="p">(</span><span class="nv">X</span><span class="p">)</span> <span class="k">when</span> <span class="nv">X</span> <span class="o">&gt;=</span> <span class="sc">$0</span><span class="p">,</span> <span class="nv">X</span> <span class="o">=&lt;</span> <span class="sc">$9</span> <span class="o">-&gt;</span>
    <span class="nv">X</span> <span class="o">-</span> <span class="sc">$0</span><span class="p">;</span>

<span class="nf">index</span><span class="p">(</span><span class="nv">X</span><span class="p">)</span> <span class="k">when</span> <span class="nv">X</span> <span class="o">&gt;=</span> <span class="sc">$A</span><span class="p">,</span> <span class="nv">X</span> <span class="o">=&lt;</span> <span class="sc">$Z</span> <span class="o">-&gt;</span>
    <span class="nv">X</span> <span class="o">-</span> <span class="sc">$A</span><span class="p">.</span>
</pre></div>
</div>
<p>我们看一下以下的例子：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="o">&gt;</span> <span class="nn">pin</span><span class="p">:</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;3451&quot;</span><span class="p">,</span><span class="s">&quot;DECLARATIVE&quot;</span><span class="p">).</span>
<span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span>
 <span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}</span>
</pre></div>
</div>
<p>我们现在使用随机数来替换没有被填充的<tt class="docutils literal"><span class="pre">nil</span></tt>元素：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">print_code</span><span class="p">([],</span> <span class="nv">Seed</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">Seed</span><span class="p">;</span>

<span class="nf">print_code</span><span class="p">([</span><span class="n">nil</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span> <span class="nv">Seed</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">NewSeed</span> <span class="o">=</span> <span class="n">ran</span><span class="p">(</span><span class="nv">Seed</span><span class="p">),</span>
    <span class="nv">Digit</span> <span class="o">=</span> <span class="nv">NewSeed</span> <span class="ow">rem</span> <span class="mi">10</span><span class="p">,</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;</span><span class="si">~w</span><span class="s"> &quot;</span><span class="p">,[</span><span class="nv">Digit</span><span class="p">]),</span>
    <span class="n">print_code</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">NewSeed</span><span class="p">);</span>

<span class="nf">print_code</span><span class="p">([</span><span class="nv">H</span><span class="p">|</span><span class="nv">T</span><span class="p">],</span><span class="nv">Seed</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;</span><span class="si">~w</span><span class="s"> &quot;</span><span class="p">,[</span><span class="nv">H</span><span class="p">]),</span>
<span class="nf">print_code</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">Seed</span><span class="p">).</span>

<span class="nf">ran</span><span class="p">(</span><span class="nv">Seed</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">(</span><span class="mi">125</span> <span class="o">*</span> <span class="nv">Seed</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">rem</span> <span class="mi">4096</span><span class="p">.</span>
</pre></div>
</div>
<p>然后我们需要一些小函数将所有东西连接在一起：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">test</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="n">title</span><span class="p">(),</span>
    <span class="nv">Password</span> <span class="o">=</span> <span class="s">&quot;DECLARATIVE&quot;</span><span class="p">,</span>
    <span class="n">entries</span><span class="p">([{</span><span class="s">&quot;3451&quot;</span><span class="p">,</span><span class="nv">Password</span><span class="p">,</span><span class="n">lisa</span><span class="p">},</span>
             <span class="p">{</span><span class="s">&quot;1234&quot;</span><span class="p">,</span><span class="nv">Password</span><span class="p">,</span><span class="n">carwash</span><span class="p">},</span>
             <span class="p">{</span><span class="s">&quot;4321&quot;</span><span class="p">,</span><span class="nv">Password</span><span class="p">,</span><span class="n">bigbank</span><span class="p">},</span>
             <span class="p">{</span><span class="s">&quot;7568&quot;</span><span class="p">,</span><span class="nv">Password</span><span class="p">,</span><span class="n">doorcode1</span><span class="p">},</span>
             <span class="p">{</span><span class="s">&quot;8832&quot;</span><span class="p">,</span><span class="nv">Password</span><span class="p">,</span><span class="n">doorcode2</span><span class="p">},</span>
             <span class="p">{</span><span class="s">&quot;4278&quot;</span><span class="p">,</span><span class="nv">Password</span><span class="p">,</span><span class="n">cashcard</span><span class="p">},</span>
             <span class="p">{</span><span class="s">&quot;4278&quot;</span><span class="p">,</span><span class="nv">Password</span><span class="p">,</span><span class="n">chequecard</span><span class="p">}]).</span>

<span class="nf">title</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;a b c d e f g h i j k l m \</span>
<span class="s">               n o p q r s t u v w x y z</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,[]).</span>

<span class="nf">entries</span><span class="p">(</span><span class="nv">List</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{_,_,</span><span class="nv">Seed</span><span class="p">}</span> <span class="o">=</span> <span class="n">time</span><span class="p">(),</span>
    <span class="n">entries</span><span class="p">(</span><span class="nv">List</span><span class="p">,</span> <span class="nv">Seed</span><span class="p">).</span>

<span class="nf">entries</span><span class="p">([],</span> <span class="p">_)</span> <span class="o">-&gt;</span> <span class="n">true</span><span class="p">;</span>

<span class="nf">entries</span><span class="p">([{</span><span class="nv">Pin</span><span class="p">,</span><span class="nv">Password</span><span class="p">,</span><span class="nv">Title</span><span class="p">}|</span><span class="nv">T</span><span class="p">],</span> <span class="nv">Seed</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">Code</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="nv">Pin</span><span class="p">,</span> <span class="nv">Password</span><span class="p">),</span>
    <span class="nv">NewSeed</span> <span class="o">=</span> <span class="n">print_code</span><span class="p">(</span><span class="nb">tuple_to_list</span><span class="p">(</span><span class="nv">Code</span><span class="p">),</span> <span class="nv">Seed</span><span class="p">),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="s">&quot; </span><span class="si">~w~n</span><span class="s">&quot;</span><span class="p">,[</span><span class="nv">Title</span><span class="p">]),</span>
    <span class="n">entries</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">NewSeed</span><span class="p">).</span>
</pre></div>
</div>
<p>最后我们可以运行这个程序了：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="mi">1</span><span class="o">&gt;</span> <span class="nn">pin</span><span class="p">:</span><span class="n">test</span><span class="p">().</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span> <span class="n">l</span> <span class="n">m</span> <span class="n">n</span> <span class="n">o</span> <span class="n">p</span> <span class="n">q</span> <span class="n">r</span> <span class="n">s</span> <span class="n">t</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span> <span class="n">x</span> <span class="n">y</span> <span class="n">z</span>
<span class="mi">1</span> <span class="mi">0</span> <span class="mi">5</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">9</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">6</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">5</span> <span class="mi">0</span> <span class="n">lisa</span>
<span class="mi">9</span> <span class="mi">0</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">0</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">9</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">2</span> <span class="n">carwash</span>
<span class="mi">7</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">0</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">5</span> <span class="mi">8</span> <span class="n">bigbank</span>
<span class="mi">1</span> <span class="mi">0</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">9</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">9</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">4</span> <span class="n">doorcode1</span>
<span class="mi">1</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">2</span> <span class="mi">9</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">6</span> <span class="mi">9</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">8</span> <span class="n">doorcode2</span>
<span class="mi">7</span> <span class="mi">4</span> <span class="mi">7</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">8</span> <span class="mi">5</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">4</span> <span class="mi">7</span> <span class="mi">6</span> <span class="mi">5</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">9</span> <span class="mi">0</span> <span class="mi">9</span> <span class="mi">6</span> <span class="mi">3</span> <span class="mi">8</span> <span class="n">cashcard</span>
<span class="mi">7</span> <span class="mi">4</span> <span class="mi">7</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">7</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">6</span> <span class="mi">3</span> <span class="mi">8</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">4</span> <span class="n">chequecard</span>
<span class="n">true</span>
</pre></div>
</div>
<p>之后这些信息可以用很小的字体打印出来，粘在一张邮票的背后，藏在你的领带里面<a class="footnote-reference" href="#id12" id="id5">[2]</a>。</p>
</div>
<div class="section" id="id6">
<h2>字典<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>我们将一组键惟一的<tt class="docutils literal"><span class="pre">键—值</span></tt>（<tt class="docutils literal"><span class="pre">Key-Value</span></tt>）对定义为字典<a class="footnote-reference" href="#id13" id="id7">[3]</a>。存在字典里的值可能会重复。对<tt class="docutils literal"><span class="pre">Key</span></tt>和<tt class="docutils literal"><span class="pre">Value</span></tt>的数据类型都没有限制，但是只能通过<tt class="docutils literal"><span class="pre">Key</span></tt>来查询字典。</p>
<p>我们定义一下字典操作：</p>
<p><tt class="docutils literal"><span class="pre">new()</span></tt></p>
<blockquote>
<div>创建并返回一个空字典。</div></blockquote>
<p><tt class="docutils literal"><span class="pre">lookup(Key,</span> <span class="pre">Dict)</span></tt></p>
<blockquote>
<div>在字典<tt class="docutils literal"><span class="pre">Dict</span></tt>中查找一个<tt class="docutils literal"><span class="pre">Key-Value</span></tt>对，如果找到则返回<tt class="docutils literal"><span class="pre">{value,</span> <span class="pre">Value}</span></tt>，否则返回<tt class="docutils literal"><span class="pre">undefined</span></tt>。</div></blockquote>
<p><tt class="docutils literal"><span class="pre">add(Key,</span> <span class="pre">Value,</span> <span class="pre">Dict)</span></tt></p>
<blockquote>
<div>添加一个新的<tt class="docutils literal"><span class="pre">Key-Value</span></tt>对到字典<tt class="docutils literal"><span class="pre">Dict</span></tt>中，并返回一个新的字典，以反映<tt class="docutils literal"><span class="pre">add</span></tt>函数对字典造成的改变。</div></blockquote>
<p><tt class="docutils literal"><span class="pre">delete(Key,</span> <span class="pre">Dict)</span></tt></p>
<blockquote>
<div>从字典<tt class="docutils literal"><span class="pre">Dict</span></tt>里删除<tt class="docutils literal"><span class="pre">Key</span></tt>所对应的<tt class="docutils literal"><span class="pre">Key-Value</span></tt>对，并返回一个新的字典。</div></blockquote>
<p>程序4.1展示了一个字典是怎样将<tt class="docutils literal"><span class="pre">Key-Value</span></tt>对以元组的形式存放到列表里面的。它并不是实现一个字典最好的方法，在这里它只是一个例子。</p>
<div class="topic">
<p class="topic-title first">程序4.1</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">dictionary</span><span class="p">).</span>
<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">new</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="n">lookup</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">add</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">delete</span><span class="o">/</span><span class="mi">2</span><span class="p">]).</span>

<span class="nf">new</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="p">[].</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">[{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">}|</span><span class="nv">Rest</span><span class="p">])</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="n">value</span><span class="p">,</span><span class="nv">Value</span><span class="p">};</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">[</span><span class="nv">Pair</span><span class="p">|</span><span class="nv">Rest</span><span class="p">])</span> <span class="o">-&gt;</span>
    <span class="n">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Rest</span><span class="p">);</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">[])</span> <span class="o">-&gt;</span>
    <span class="n">undefined</span><span class="p">.</span>

<span class="nf">add</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="nv">Dict</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">NewDict</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Dict</span><span class="p">),</span>
    <span class="p">[{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">}|</span><span class="nv">NewDict</span><span class="p">].</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">[{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">}|</span><span class="nv">Rest</span><span class="p">])</span> <span class="o">-&gt;</span>
    <span class="nv">Rest</span><span class="p">;</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">[</span><span class="nv">Pair</span><span class="p">|</span><span class="nv">Rest</span><span class="p">])</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nv">Pair</span><span class="p">|</span><span class="n">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Rest</span><span class="p">)];</span>
<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">[])</span> <span class="o">-&gt;</span>
    <span class="p">[].</span>
</pre></div>
</div>
</div>
<p>我们用<tt class="docutils literal"><span class="pre">字典</span></tt>来构建和管理一个包含了各位作者鞋码的小型数据库：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nv">D0</span> <span class="o">=</span> <span class="nn">dictionary</span><span class="p">:</span><span class="n">new</span><span class="p">().</span>
<span class="p">[]</span>
<span class="o">&gt;</span> <span class="nv">D1</span> <span class="o">=</span> <span class="nn">dictionary</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="n">joe</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="nv">D0</span><span class="p">).</span>
<span class="p">[{</span><span class="n">joe</span><span class="p">,</span><span class="mi">42</span><span class="p">}]</span>
<span class="o">&gt;</span> <span class="nv">D2</span> <span class="o">=</span> <span class="nn">dictionary</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="n">mike</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="nv">D1</span><span class="p">).</span>
<span class="p">[{</span><span class="n">mike</span><span class="p">,</span><span class="mi">41</span><span class="p">},{</span><span class="n">joe</span><span class="p">,</span><span class="mi">42</span><span class="p">}]</span>
<span class="o">&gt;</span> <span class="nv">D3</span> <span class="o">=</span> <span class="nn">dictionary</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="n">robert</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="nv">D2</span><span class="p">).</span>
<span class="p">[{</span><span class="n">robert</span><span class="p">,</span><span class="mi">43</span><span class="p">},{</span><span class="n">mike</span><span class="p">,</span><span class="mi">41</span><span class="p">},{</span><span class="n">joe</span><span class="p">,</span><span class="mi">42</span><span class="p">}]</span>
<span class="o">&gt;</span> <span class="nn">dictionary</span><span class="p">:</span><span class="n">lookup</span><span class="p">(</span><span class="n">joe</span><span class="p">,</span> <span class="nv">D3</span><span class="p">).</span>
<span class="p">{</span><span class="n">value</span><span class="p">,</span><span class="mi">42</span><span class="p">}</span>
<span class="o">&gt;</span> <span class="nn">dictionary</span><span class="p">:</span><span class="n">lookup</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="nv">D3</span><span class="p">).</span>
<span class="n">undefined</span>
<span class="p">...</span>
</pre></div>
</div>
</div>
<div class="section" id="id8">
<h2>非平衡二叉树<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<p>字典适合保存少量的数据项，但是当项的数量不断增加，更好的方法是用通过使用键的序列关系来访问数据的树形结构来组织数据。这种结构的访问时间与它所包含的项的数量成对数关系&#8211;列表是线性的访问时间。</p>
<p>我们认为最简单的树组织形式是<strong>非平衡二叉树</strong>。树内部的结点用<tt class="docutils literal"><span class="pre">{Key,</span> <span class="pre">Vlue,</span> <span class="pre">Smaller,</span> <span class="pre">Bigger}</span></tt>来表示。<tt class="docutils literal"><span class="pre">Value</span></tt>是被存储在树的一些结点中对象的值，它的键为<tt class="docutils literal"><span class="pre">Key</span></tt>。<tt class="docutils literal"><span class="pre">Smaller</span></tt>是一棵子树，它的所有结点的键值都小于<tt class="docutils literal"><span class="pre">Key</span></tt>，<tt class="docutils literal"><span class="pre">Bigger</span></tt>也是一棵子树，它的所有结点的键值都大于或等于<tt class="docutils literal"><span class="pre">Key</span></tt>。树的叶子用原子式<tt class="docutils literal"><span class="pre">nil</span></tt>表示。</p>
<p>我们从<tt class="docutils literal"><span class="pre">lookup(Key,</span> <span class="pre">Tree)</span></tt>函数开始，这个函数搜索<tt class="docutils literal"><span class="pre">Tree</span></tt>以确定树中是否有与<tt class="docutils literal"><span class="pre">Key</span></tt>相关的项。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">not_found</span><span class="p">;</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,_,_})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="n">found</span><span class="p">,</span><span class="nv">Value</span><span class="p">};</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,_,</span><span class="nv">Smaller</span><span class="p">,_})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&lt;</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="n">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Smaller</span><span class="p">);</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,_,_,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&gt;</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="n">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Bigger</span><span class="p">).</span>
</pre></div>
</div>
<p>函数<tt class="docutils literal"><span class="pre">insert(Key,</span> <span class="pre">Value,</span> <span class="pre">OldTree)</span></tt>将数据<tt class="docutils literal"><span class="pre">Key-Value</span></tt>添加到树<tt class="docutils literal"><span class="pre">OldTree</span></tt>中，并返回一棵新树。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">};</span>

<span class="nf">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,_,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">};</span>

<span class="nf">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,</span><span class="nv">V</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&lt;</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key1</span><span class="p">,</span><span class="nv">V</span><span class="p">,</span><span class="n">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="nv">Smaller</span><span class="p">),</span><span class="nv">Bigger</span><span class="p">};</span>

<span class="nf">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,</span><span class="nv">V</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&gt;</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key1</span><span class="p">,</span><span class="nv">V</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="n">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="nv">Bigger</span><span class="p">)}.</span>
</pre></div>
</div>
<p>第一个子句得到数据，并插入到一棵新树当中，第二个子句将复写已经存在的结点，第三个和第四个子句确定当<tt class="docutils literal"><span class="pre">Key</span></tt>的值小于、大于或等于树中当前结点的<tt class="docutils literal"><span class="pre">Key</span></tt>时，应该采取什么样的行为。</p>
<p>当构建了一棵树之后，我们会想用一种方法将这棵树的结构打印出来。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">write_tree</span><span class="p">(</span><span class="nv">T</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">write_tree</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">T</span><span class="p">).</span>

<span class="nf">write_tree</span><span class="p">(</span><span class="nv">D</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">tab</span><span class="p">(</span><span class="nv">D</span><span class="p">),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="n">&#39;nil&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nf">write_tree</span><span class="p">(</span><span class="nv">D</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="nv">D1</span> <span class="o">=</span> <span class="nv">D</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">write_tree</span><span class="p">(</span><span class="nv">D1</span><span class="p">,</span> <span class="nv">Bigger</span><span class="p">),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="n">&#39;~n&#39;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">tab</span><span class="p">(</span><span class="nv">D</span><span class="p">),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="n">&#39;~w ===&gt; ~w~n&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">]),</span>
    <span class="n">write_tree</span><span class="p">(</span><span class="nv">D1</span><span class="p">,</span> <span class="nv">Smaller</span><span class="p">).</span>
</pre></div>
</div>
<p>我们可以用一个测试函数将数据插入到树中，并把它打印出来：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">test1</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="nv">S1</span> <span class="o">=</span> <span class="n">nil</span><span class="p">,</span>
    <span class="nv">S2</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">joe</span><span class="p">,</span><span class="nv">S1</span><span class="p">),</span>
    <span class="nv">S3</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="n">fred</span><span class="p">,</span><span class="nv">S2</span><span class="p">),</span>
    <span class="nv">S4</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">jane</span><span class="p">,</span><span class="nv">S3</span><span class="p">),</span>
    <span class="nv">S5</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">kalle</span><span class="p">,</span><span class="nv">S4</span><span class="p">),</span>
    <span class="nv">S6</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="n">thomas</span><span class="p">,</span><span class="nv">S5</span><span class="p">),</span>
    <span class="nv">S7</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">rickard</span><span class="p">,</span><span class="nv">S6</span><span class="p">),</span>
    <span class="nv">S8</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="n">susan</span><span class="p">,</span><span class="nv">S7</span><span class="p">),</span>
    <span class="nv">S9</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">tobbe</span><span class="p">,</span><span class="nv">S8</span><span class="p">),</span>
    <span class="nv">S10</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">dan</span><span class="p">,</span><span class="nv">S9</span><span class="p">),</span>
    <span class="n">write_tree</span><span class="p">(</span><span class="nv">S10</span><span class="p">).</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">图4.1 一棵非平衡二叉树</p>
<div class="highlight-erlang"><div class="highlight"><pre>        <span class="n">nil</span>
    <span class="mi">12</span> <span class="o">===&gt;</span> <span class="n">fred</span>
                <span class="n">nil</span>
            <span class="mi">9</span> <span class="o">===&gt;</span> <span class="n">susan</span>
                    <span class="n">nil</span>
                <span class="mi">8</span> <span class="o">===&gt;</span> <span class="n">dan</span>
                    <span class="n">nil</span>
        <span class="mi">7</span> <span class="o">===&gt;</span> <span class="n">kalle</span>
                <span class="n">nil</span>
            <span class="mi">6</span> <span class="o">===&gt;</span> <span class="n">thomas</span>
                    <span class="n">nil</span>
                <span class="mi">5</span> <span class="o">===&gt;</span> <span class="n">rickard</span>
                    <span class="n">nil</span>
<span class="mi">4</span> <span class="o">===&gt;</span> <span class="n">joe</span>
        <span class="n">nil</span>
    <span class="mi">3</span> <span class="o">===&gt;</span> <span class="n">jane</span>
            <span class="n">nil</span>
        <span class="mi">2</span> <span class="o">===&gt;</span> <span class="n">tobbe</span>
            <span class="n">nil</span>
</pre></div>
</div>
</div>
<p>注意这棵树并不是十分“平衡”。按照严格的顺序插入键的队列，比如像这样：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nv">T1</span> <span class="o">=</span> <span class="n">nil</span><span class="p">,</span>
<span class="nv">T2</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nv">T1</span><span class="p">),</span>
<span class="nv">T3</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nv">T2</span><span class="p">),</span>
<span class="nv">T4</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nv">T3</span><span class="p">),</span>
<span class="nv">T5</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nv">T4</span><span class="p">),</span>
<span class="p">...</span>
<span class="nv">T9</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="nv">T8</span><span class="p">).</span>
</pre></div>
</div>
<p>使这棵树看起来变成了一个列表（见图4.2）。</p>
<p>当键的顺序随机的时候，我们使用的方法是很好的。如果在一个插入序列里，键是有序排列的，这棵树就变成了一个列表。我们将在第??章讲述怎样构建平衡二叉树。</p>
<div class="topic">
<p class="topic-title first">图4.2 变化后的非平衡二叉树</p>
<div class="highlight-erlang"><div class="highlight"><pre>                                    <span class="n">nil</span>
                            <span class="mi">8</span> <span class="o">===&gt;</span> <span class="n">a</span>
                                <span class="n">nil</span>
                        <span class="mi">7</span> <span class="o">===&gt;</span> <span class="n">a</span>
                            <span class="n">nil</span>
                    <span class="mi">6</span> <span class="o">===&gt;</span> <span class="n">a</span>
                        <span class="n">nil</span>
                <span class="mi">5</span> <span class="o">===&gt;</span> <span class="n">a</span>
                    <span class="n">nil</span>
            <span class="mi">4</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
        <span class="mi">3</span> <span class="o">===&gt;</span> <span class="n">a</span>
            <span class="n">nil</span>
    <span class="mi">2</span> <span class="o">===&gt;</span> <span class="n">a</span>
        <span class="n">nil</span>
<span class="mi">1</span> <span class="o">===&gt;</span> <span class="n">a</span>
    <span class="n">nil</span>
</pre></div>
</div>
</div>
<p>我们也需要能够删除二叉树内的元素：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">nil</span><span class="p">;</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,_,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="n">nil</span><span class="p">;</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,_,</span><span class="nv">Smaller</span><span class="p">,</span><span class="n">nil</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="nv">Smaller</span><span class="p">;</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,_,</span><span class="n">nil</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="nv">Bigger</span><span class="p">;</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,_,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">==</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">Smaller2</span><span class="p">}</span> <span class="o">=</span> <span class="n">deletesp</span><span class="p">(</span><span class="nv">Smaller</span><span class="p">),</span>
    <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">Smaller2</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">};</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,</span><span class="nv">V</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&lt;</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key1</span><span class="p">,</span><span class="nv">V</span><span class="p">,</span><span class="n">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Smaller</span><span class="p">),</span><span class="nv">Bigger</span><span class="p">};</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,</span><span class="nv">V</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&gt;</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key1</span><span class="p">,</span><span class="nv">V</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="n">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Bigger</span><span class="p">)}.</span>
</pre></div>
</div>
<p>当要删除的结点是树中的叶子，或者在这个结点下面只有一颗子树时，删除操作是很容易的（子句1到4）。子句6和7中，要删除的结点并没有被确定位置，而是继续在合适的子树中向前搜索。</p>
<p>在子句5当中，要删除的结点被找到，但是它是树中的一个<tt class="docutils literal"><span class="pre">内部</span></tt>结点（例如结点同时有<tt class="docutils literal"><span class="pre">Smaller</span></tt>和<tt class="docutils literal"><span class="pre">Bigger</span></tt>子树）。这种情况下,<tt class="docutils literal"><span class="pre">Smaller</span></tt>子树中具有<tt class="docutils literal"><span class="pre">最大</span></tt>键的结点将被删除，并且整棵树在这个点重建。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">deletesp</span><span class="p">({</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="n">nil</span><span class="p">};</span>

<span class="nf">deletesp</span><span class="p">({</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="n">nil</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">};</span>

<span class="nf">deletesp</span><span class="p">({</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">Bigger2</span><span class="p">}</span> <span class="o">=</span> <span class="n">deletesp</span><span class="p">(</span><span class="nv">Bigger</span><span class="p">),</span>
    <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger2</span><span class="p">}}.</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h2>平衡二叉树<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<p>在前面几节里，我们学会了怎样构建一棵非平衡二叉树。但不幸的是非平衡二叉树可能会变成一个列表，这样对树的插入和删除操作就是非随机的了。</p>
<p>一个更好的方法是保持树在任何情况下都是<strong>平衡</strong>的。</p>
<p>Adelsom-Velskii和Landis [?]（在[?]中描述）使用一个简单的标准来衡量<strong>平衡</strong>这个概念：如果一棵树的每个结点的两个子树高度之差不超过1，我们就说这棵树是平衡的。具有这种特性的树常常被称作<em>AVL</em>树。平衡二叉树能够在<tt class="docutils literal"><span class="pre">O(logN)</span></tt>的时间规模里完成查找、插入和删除操作，<tt class="docutils literal"><span class="pre">N</span></tt>是树中结点的个数。</p>
<p>假设我们用元组<tt class="docutils literal"><span class="pre">{Key,</span> <span class="pre">Value,</span> <span class="pre">Height,</span> <span class="pre">Smaller,</span> <span class="pre">Bigger}</span></tt>表示一棵 AVL树，用<tt class="docutils literal"><span class="pre">{_,</span> <span class="pre">_,</span> <span class="pre">0,</span> <span class="pre">_,</span> <span class="pre">_}</span></tt>表示一棵空树。然后在树中的查找操作就很容易实现了：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="n">not_found</span><span class="p">;</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,_,_,_})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="n">found</span><span class="p">,</span><span class="nv">Value</span><span class="p">};</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,_,_,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&lt;</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="n">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">);</span>

<span class="nf">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,_,_,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&gt;</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="n">lookup</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">).</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">lookup</span></tt>的代码和非平衡二叉树中的基本一样。插入操作这样实现：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="nv">E</span> <span class="o">=</span> <span class="n">empty_tree</span><span class="p">(),</span>
    <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nv">E</span><span class="p">,</span><span class="nv">E</span><span class="p">};</span>

<span class="nf">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">H2</span><span class="p">,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">==</span> <span class="nv">K2</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="nv">H2</span><span class="p">,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">};</span>

<span class="nf">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,_,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&lt;</span> <span class="nv">K2</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">K4</span><span class="p">,</span><span class="nv">V4</span><span class="p">,_,</span><span class="nv">S4</span><span class="p">,</span><span class="nv">B4</span><span class="p">}</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="nv">S2</span><span class="p">),</span>
<span class="nf">combine</span><span class="p">(</span><span class="nv">S4</span><span class="p">,</span> <span class="nv">K4</span><span class="p">,</span> <span class="nv">V4</span><span class="p">,</span> <span class="nv">B4</span><span class="p">,</span> <span class="nv">K2</span><span class="p">,</span> <span class="nv">V2</span><span class="p">,</span> <span class="nv">B2</span><span class="p">);</span>

<span class="nf">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,_,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&gt;</span> <span class="nv">K2</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">K4</span><span class="p">,</span><span class="nv">V4</span><span class="p">,_,</span><span class="nv">S4</span><span class="p">,</span><span class="nv">B4</span><span class="p">}</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="nv">B2</span><span class="p">),</span>
    <span class="n">combine</span><span class="p">(</span><span class="nv">S2</span><span class="p">,</span> <span class="nv">K2</span><span class="p">,</span> <span class="nv">V2</span><span class="p">,</span> <span class="nv">S4</span><span class="p">,</span> <span class="nv">K4</span><span class="p">,</span> <span class="nv">V4</span><span class="p">,</span> <span class="nv">B4</span><span class="p">).</span>

<span class="nf">empty_tree</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}.</span>
</pre></div>
</div>
<p>思路是找到要插入的项将被插入到什么地方，如果插入使得树变得不平衡了，那么就平衡它。平衡一棵树的操作通过<tt class="docutils literal"><span class="pre">combine</span></tt>函数实现<a class="footnote-reference" href="#id14" id="id10">[4]</a>。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">combine</span><span class="p">({</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,</span><span class="nv">H1</span><span class="p">,</span><span class="nv">S1</span><span class="p">,</span><span class="nv">B1</span><span class="p">},</span><span class="nv">AK</span><span class="p">,</span><span class="nv">AV</span><span class="p">,</span>
        <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">H2</span><span class="p">,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">},</span><span class="nv">BK</span><span class="p">,</span><span class="nv">BV</span><span class="p">,</span>
        <span class="p">{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,</span><span class="nv">H3</span><span class="p">,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">}</span> <span class="p">)</span> <span class="k">when</span> <span class="nv">H2</span> <span class="o">&gt;</span> <span class="nv">H1</span><span class="p">,</span> <span class="nv">H2</span> <span class="o">&gt;</span> <span class="nv">H3</span> <span class="o">-&gt;</span>
            <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">H1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
             <span class="p">{</span><span class="nv">AK</span><span class="p">,</span><span class="nv">AV</span><span class="p">,</span><span class="nv">H1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,{</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,</span><span class="nv">H1</span><span class="p">,</span><span class="nv">S1</span><span class="p">,</span><span class="nv">B1</span><span class="p">},</span><span class="nv">S2</span><span class="p">},</span>
             <span class="p">{</span><span class="nv">BK</span><span class="p">,</span><span class="nv">BV</span><span class="p">,</span><span class="nv">H3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="nv">B2</span><span class="p">,{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,</span><span class="nv">H3</span><span class="p">,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">}}</span>
            <span class="p">};</span>
<span class="nf">combine</span><span class="p">({</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,</span><span class="nv">H1</span><span class="p">,</span><span class="nv">S1</span><span class="p">,</span><span class="nv">B1</span><span class="p">},</span><span class="nv">AK</span><span class="p">,</span><span class="nv">AV</span><span class="p">,</span>
        <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">H2</span><span class="p">,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">},</span><span class="nv">BK</span><span class="p">,</span><span class="nv">BV</span><span class="p">,</span>
        <span class="p">{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,</span><span class="nv">H3</span><span class="p">,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">}</span> <span class="p">)</span> <span class="k">when</span> <span class="nv">H1</span> <span class="o">&gt;=</span> <span class="nv">H2</span><span class="p">,</span> <span class="nv">H1</span> <span class="o">&gt;=</span> <span class="nv">H3</span> <span class="o">-&gt;</span>
            <span class="nv">HB</span> <span class="o">=</span> <span class="n">max_add_1</span><span class="p">(</span><span class="nv">H2</span><span class="p">,</span><span class="nv">H3</span><span class="p">),</span>
    <span class="nv">HA</span> <span class="o">=</span> <span class="n">max_add_1</span><span class="p">(</span><span class="nv">H1</span><span class="p">,</span><span class="nv">HB</span><span class="p">),</span>
    <span class="p">{</span><span class="nv">AK</span><span class="p">,</span><span class="nv">AV</span><span class="p">,</span><span class="nv">HA</span><span class="p">,</span>
            <span class="p">{</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,</span><span class="nv">H1</span><span class="p">,</span><span class="nv">S1</span><span class="p">,</span><span class="nv">B1</span><span class="p">},</span>
            <span class="p">{</span><span class="nv">BK</span><span class="p">,</span><span class="nv">BV</span><span class="p">,</span><span class="nv">HB</span><span class="p">,{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">H2</span><span class="p">,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">},{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,</span><span class="nv">H3</span><span class="p">,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">}}</span>
           <span class="p">};</span>
<span class="nf">combine</span><span class="p">({</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,</span><span class="nv">H1</span><span class="p">,</span><span class="nv">S1</span><span class="p">,</span><span class="nv">B1</span><span class="p">},</span><span class="nv">AK</span><span class="p">,</span><span class="nv">AV</span><span class="p">,</span>
        <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">H2</span><span class="p">,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">},</span><span class="nv">BK</span><span class="p">,</span><span class="nv">BV</span><span class="p">,</span>
        <span class="p">{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,</span><span class="nv">H3</span><span class="p">,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">}</span> <span class="p">)</span> <span class="k">when</span> <span class="nv">H3</span> <span class="o">&gt;=</span> <span class="nv">H1</span><span class="p">,</span> <span class="nv">H3</span> <span class="o">&gt;=</span> <span class="nv">H2</span> <span class="o">-&gt;</span>
            <span class="nv">HA</span> <span class="o">=</span> <span class="n">max_add_1</span><span class="p">(</span><span class="nv">H1</span><span class="p">,</span><span class="nv">H2</span><span class="p">),</span>
    <span class="nv">HB</span> <span class="o">=</span> <span class="n">max_add_1</span><span class="p">(</span><span class="nv">HA</span><span class="p">,</span><span class="nv">H3</span><span class="p">),</span>
    <span class="p">{</span><span class="nv">BK</span><span class="p">,</span><span class="nv">BV</span><span class="p">,</span><span class="nv">HB</span> <span class="p">,</span>
            <span class="p">{</span><span class="nv">AK</span><span class="p">,</span><span class="nv">AV</span><span class="p">,</span><span class="nv">HA</span><span class="p">,{</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,</span><span class="nv">H1</span><span class="p">,</span><span class="nv">S1</span><span class="p">,</span><span class="nv">B1</span><span class="p">},{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">H2</span><span class="p">,</span><span class="nv">S2</span><span class="p">,</span><span class="nv">B2</span><span class="p">}},</span>
            <span class="p">{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,</span><span class="nv">H3</span><span class="p">,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">}</span>
           <span class="p">}.</span>

<span class="nf">max_add_1</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="nv">Y</span><span class="p">)</span> <span class="k">when</span> <span class="nv">X</span> <span class="o">=&lt;</span> <span class="nv">Y</span> <span class="o">-&gt;</span>
    <span class="nv">Y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nf">max_add_1</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span><span class="nv">Y</span><span class="p">)</span> <span class="k">when</span> <span class="nv">X</span> <span class="o">&gt;</span> <span class="nv">Y</span> <span class="o">-&gt;</span>
    <span class="nv">X</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span>
</pre></div>
</div>
<p>打印一棵树也很简单:</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">write_tree</span><span class="p">(</span><span class="nv">T</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">write_tree</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">T</span><span class="p">).</span>

<span class="nf">write_tree</span><span class="p">(</span><span class="nv">D</span><span class="p">,</span> <span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">tab</span><span class="p">(</span><span class="nv">D</span><span class="p">),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="n">&#39;nil&#39;</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nf">write_tree</span><span class="p">(</span><span class="nv">D</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,_,</span><span class="nv">Smaller</span><span class="p">,</span><span class="nv">Bigger</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="nv">D1</span> <span class="o">=</span> <span class="nv">D</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">write_tree</span><span class="p">(</span><span class="nv">D1</span><span class="p">,</span> <span class="nv">Bigger</span><span class="p">),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="n">&#39;~n&#39;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">tab</span><span class="p">(</span><span class="nv">D</span><span class="p">),</span>
    <span class="nn">io</span><span class="p">:</span><span class="n">format</span><span class="p">(</span><span class="n">&#39;~w ===&gt; ~w~n&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">]),</span>
    <span class="n">write_tree</span><span class="p">(</span><span class="nv">D1</span><span class="p">,</span> <span class="nv">Smaller</span><span class="p">).</span>
</pre></div>
</div>
<p>现在让我们来看看我们的劳动成果。假设我们在一棵AVL树中插入键为<tt class="docutils literal"><span class="pre">1,2,3,...,16</span></tt>的16个数据。结果如图4.3，它是一棵平衡的树了（跟上一节那棵变形的树比较一下）。</p>
<p>最后是AVL树中的删除操作：</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">};</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,_,</span><span class="mi">1</span><span class="p">,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">},{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">};</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,_,_,</span><span class="nv">Smaller</span><span class="p">,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}})</span> <span class="o">-&gt;</span>
    <span class="nv">Smaller</span><span class="p">;</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key</span><span class="p">,_,_,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">},</span><span class="nv">Bigger</span><span class="p">})</span> <span class="o">-&gt;</span>
    <span class="nv">Bigger</span><span class="p">;</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">Key1</span><span class="p">,_,_,</span><span class="nv">Smaller</span><span class="p">,{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,_,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">}})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">==</span> <span class="nv">Key1</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">Smaller2</span><span class="p">}</span> <span class="o">=</span> <span class="n">deletesp</span><span class="p">(</span><span class="nv">Smaller</span><span class="p">),</span>
    <span class="n">combine</span><span class="p">(</span><span class="nv">Smaller2</span><span class="p">,</span> <span class="nv">K2</span><span class="p">,</span> <span class="nv">V2</span><span class="p">,</span> <span class="nv">S3</span><span class="p">,</span> <span class="nv">K3</span><span class="p">,</span> <span class="nv">V3</span><span class="p">,</span> <span class="nv">B3</span><span class="p">);</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,_,</span><span class="nv">Smaller</span><span class="p">,{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,_,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">}})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&lt;</span> <span class="nv">K1</span> <span class="o">-&gt;</span>
    <span class="nv">Smaller2</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Smaller</span><span class="p">),</span>
    <span class="n">combine</span><span class="p">(</span><span class="nv">Smaller2</span><span class="p">,</span> <span class="nv">K1</span><span class="p">,</span> <span class="nv">V1</span><span class="p">,</span> <span class="nv">S3</span><span class="p">,</span> <span class="nv">K3</span><span class="p">,</span> <span class="nv">V3</span><span class="p">,</span> <span class="nv">B3</span><span class="p">);</span>

<span class="nf">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="p">{</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,_,{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,_,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">},</span><span class="nv">Bigger</span><span class="p">})</span> <span class="k">when</span> <span class="nv">Key</span> <span class="o">&gt;</span> <span class="nv">K1</span> <span class="o">-&gt;</span>
    <span class="nv">Bigger2</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="nv">Key</span><span class="p">,</span> <span class="nv">Bigger</span><span class="p">),</span>
    <span class="n">combine</span><span class="p">(</span> <span class="nv">S3</span><span class="p">,</span> <span class="nv">K3</span><span class="p">,</span> <span class="nv">V3</span><span class="p">,</span> <span class="nv">B3</span><span class="p">,</span> <span class="nv">K1</span><span class="p">,</span> <span class="nv">V1</span><span class="p">,</span> <span class="nv">Bigger2</span><span class="p">).</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">图4.3 一棵平衡二叉树</p>
<div class="highlight-erlang"><div class="highlight"><pre>                    <span class="n">nil</span>
                <span class="mi">16</span> <span class="o">===&gt;</span> <span class="n">a</span>
                    <span class="n">nil</span>
            <span class="mi">15</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
        <span class="mi">14</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
            <span class="mi">13</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
    <span class="mi">12</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
            <span class="mi">11</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
        <span class="mi">10</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
            <span class="mi">9</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
<span class="mi">8</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
            <span class="mi">7</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
        <span class="mi">6</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
            <span class="mi">5</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
    <span class="mi">4</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
            <span class="mi">3</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
        <span class="mi">2</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
            <span class="mi">1</span> <span class="o">===&gt;</span> <span class="n">a</span>
                <span class="n">nil</span>
</pre></div>
</div>
</div>
<p><tt class="docutils literal"><span class="pre">deletisp</span></tt>函数删除并返回树中最大的元素。</p>
<div class="highlight-erlang"><div class="highlight"><pre><span class="nf">deletesp</span><span class="p">({</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="mi">1</span><span class="p">,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">},{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}};</span>
<span class="nf">deletesp</span><span class="p">({</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,_,</span><span class="nv">Smaller</span><span class="p">,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}})</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,</span><span class="nv">Smaller</span><span class="p">};</span>
<span class="nf">deletesp</span><span class="p">({</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,</span><span class="mi">2</span><span class="p">,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">},</span>
         <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="mi">1</span><span class="p">,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">},{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}}})</span> <span class="o">-&gt;</span>
            <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span>
             <span class="p">{</span><span class="nv">K1</span><span class="p">,</span><span class="nv">V1</span><span class="p">,</span><span class="mi">1</span><span class="p">,{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">},{</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">nil</span><span class="p">,</span><span class="n">nil</span><span class="p">}}</span>
            <span class="p">};</span>

<span class="nf">deletesp</span><span class="p">({</span><span class="nv">Key</span><span class="p">,</span><span class="nv">Value</span><span class="p">,_,{</span><span class="nv">K3</span><span class="p">,</span><span class="nv">V3</span><span class="p">,_,</span><span class="nv">S3</span><span class="p">,</span><span class="nv">B3</span><span class="p">},</span><span class="nv">Bigger</span><span class="p">})</span> <span class="o">-&gt;</span>
        <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="nv">Bigger2</span><span class="p">}</span> <span class="o">=</span> <span class="n">deletesp</span><span class="p">(</span><span class="nv">Bigger</span><span class="p">),</span>
        <span class="p">{</span><span class="nv">K2</span><span class="p">,</span><span class="nv">V2</span><span class="p">,</span><span class="n">combine</span><span class="p">(</span><span class="nv">S3</span><span class="p">,</span> <span class="nv">K3</span><span class="p">,</span> <span class="nv">V3</span><span class="p">,</span> <span class="nv">B3</span><span class="p">,</span> <span class="nv">Key</span><span class="p">,</span> <span class="nv">Value</span><span class="p">,</span> <span class="nv">Bigger2</span><span class="p">)}.</span>
</pre></div>
</div>
<p class="rubric">脚注</p>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[1]</a></td><td><tt class="docutils literal"><span class="pre">encode/2</span></tt>和本章其它一些例子的代码调用了<tt class="docutils literal"><span class="pre">io</span></tt>模块中的函数。这个模块是一个提供给用户进行格式化输入输出的标准模块。它的详细特性将在第??章和附录??中描述。</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[2]</a></td><td>只有一个作者是系领带的。</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[3]</a></td><td>这在数据库管理系统的<strong>数据字典</strong>里面是不用怀疑的。</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[4]</a></td><td>有关合并规则的详细描述可以在第[??]章找到。</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">第4章 使用元组</a><ul>
<li><a class="reference internal" href="#bif">处理元组的BIF</a></li>
<li><a class="reference internal" href="#id2">返回多个值</a></li>
<li><a class="reference internal" href="#id3">密码加密</a></li>
<li><a class="reference internal" href="#id6">字典</a></li>
<li><a class="reference internal" href="#id8">非平衡二叉树</a></li>
<li><a class="reference internal" href="#id9">平衡二叉树</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="part-i_chapter-3.html"
                        title="上一章">第3章 列表编程</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="part-i_chapter-5.html"
                        title="下一章">第5章 并行编程</a></p>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的模块，术语，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="part-i_chapter-5.html" title="第5章 并行编程"
             >下一页</a></li>
        <li class="right" >
          <a href="part-i_chapter-3.html" title="第3章 列表编程"
             >上一页</a> |</li>
        <li><a href="index.html">Erlang并发编程</a> &raquo;</li>
          <li><a href="part-i_index.html" >第 I 部分 编程</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; 版权所有 2009, CPiE-CN志愿译者团队.
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>